pre-commit:
  parallel: true
  commands:
    fmt-check:
      root: "terraform/"
      glob: "*.tf"
      run: terraform fmt -check
      fail_text: "Run 'mise run tf fmt' to fix formatting"
    validate:
      root: "terraform/"
      glob: "*.tf"
      run: terraform validate
    lint:
      root: "terraform/"
      glob: "*.tf"
      run: tflint
    kustomize:
      glob: "kubernetes/**/*.yaml"
      run: |
        for dir in kubernetes/*/; do
          if [ -f "${dir}kustomization.yaml" ]; then
            kustomize build "$dir" > /dev/null
          fi
        done
    gitleaks:
      run: gitleaks git --pre-commit --staged

commit-msg:
  commands:
    conventional:
      run: 'grep -qE "^(Merge .+|(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?!?: .+)$" {1}'
      fail_text: "Commit message must follow conventional commits: type(scope): message (merge commits are also allowed)"
